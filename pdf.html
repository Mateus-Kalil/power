<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WolfGuard PDF Editor - Editor Profissional de PDF</title>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>ðŸ›¡</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0a0e27;
            --secondary: #1a1f3a;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --text: #e5e7eb;
            --text-secondary: #9ca3af;
            --border: #374151;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent) 0%, #6366f1 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 80px);
        }

        .sidebar {
            background: rgba(26, 31, 58, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .sidebar h3 {
            margin-bottom: 1rem;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        .tool-group {
            margin-bottom: 2rem;
        }

        .tool-btn {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9rem;
        }

        .tool-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: var(--accent);
            transform: translateX(2px);
        }

        .tool-btn.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .tool-btn svg {
            width: 18px;
            height: 18px;
        }

        .main-content {
            background: rgba(26, 31, 58, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            min-height: 600px;
        }

        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 4rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(59, 130, 246, 0.05);
        }

        .upload-zone:hover {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.1);
        }

        .upload-zone.drag-over {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.15);
        }

        .upload-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            background: linear-gradient(135deg, var(--accent) 0%, #6366f1 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }

        .canvas-container {
            position: relative;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            overflow: auto;
            max-height: calc(100vh - 200px);
            display: none;
        }

        .canvas-container.active {
            display: block;
        }

        canvas {
            display: block;
            cursor: crosshair;
        }

        .toolbar {
            display: none;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .toolbar.active {
            display: flex;
        }

        .toolbar-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            padding: 0 1rem;
            border-right: 1px solid var(--border);
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar-btn {
            padding: 0.5rem 1rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toolbar-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: var(--accent);
        }

        .toolbar-btn.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        input[type="color"],
        input[type="number"],
        input[type="range"] {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            padding: 0.5rem;
        }

        input[type="color"] {
            width: 50px;
            height: 38px;
            cursor: pointer;
        }

        input[type="number"] {
            width: 70px;
        }

        input[type="range"] {
            width: 120px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.875rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: rgba(59, 130, 246, 0.1);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 0.875rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-secondary:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: var(--accent);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 1rem;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(59, 130, 246, 0.2);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            display: none;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            color: var(--danger);
            text-align: center;
        }

        .error-message.active {
            display: block;
        }

        .success-message {
            display: none;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            color: var(--success);
            text-align: center;
        }

        .success-message.active {
            display: block;
        }

        .pages-nav {
            display: none;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(10, 14, 39, 0.95);
            border-radius: 8px;
        }

        .pages-nav.active {
            display: flex;
        }

        .page-btn {
            padding: 0.5rem 1rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            cursor: pointer;
        }

        .page-btn:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .page-btn.active {
            background: var(--accent);
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: relative;
                top: 0;
            }

            .toolbar {
                flex-direction: column;
            }

            .toolbar-group {
                border-right: none;
                border-bottom: 1px solid var(--border);
                padding: 0.5rem 0;
            }

            .toolbar-group:last-child {
                border-bottom: none;
            }
        }

        @media (max-width: 640px) {
            .header {
                padding: 1rem;
            }

            .container {
                padding: 1rem;
            }

            .logo {
                font-size: 1.25rem;
            }

            .main-content {
                padding: 1rem;
            }

            .upload-zone {
                padding: 2rem 1rem;
            }

            .modal-content {
                padding: 1.5rem;
                max-width: 95% !important;
            }
        }

        .correction-item {
            padding: 1rem;
            margin-bottom: 1rem;
            background: rgba(59, 130, 246, 0.08);
            border-left: 3px solid var(--accent);
            border-radius: 6px;
        }

        .correction-error {
            color: var(--danger);
            font-weight: 600;
            text-decoration: line-through;
        }

        .correction-fixed {
            color: var(--success);
            font-weight: 600;
        }

        textarea {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--accent);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <div class="logo-icon">ðŸ›¡</div>
            <span>WolfGuard PDF Editor</span>
        </div>
    </header>

    <div class="container">
        <aside class="sidebar">
            <div class="tool-group">
                <h3>Arquivo</h3>
                <button class="tool-btn" onclick="document.getElementById('fileInput').click()">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"/></svg>
                    Abrir PDF
                </button>
                <button class="tool-btn" onclick="savePDF()">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293zM9 4a1 1 0 012 0v2H9V4z"/></svg>
                    Salvar PDF
                </button>
                <button class="tool-btn" onclick="convertToWord()">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path d="M9 2a2 2 0 00-2 2v8a2 2 0 002 2h6a2 2 0 002-2V6.414A2 2 0 0016.414 5L14 2.586A2 2 0 0012.586 2H9z"/><path d="M3 8a2 2 0 012-2v10h8a2 2 0 01-2 2H5a2 2 0 01-2-2V8z"/></svg>
                    Converter para Word
                </button>
            </div>

            <div class="tool-group">
                <h3>CorreÃ§Ã£o de Texto</h3>
                <button class="tool-btn" onclick="correctPortuguese()">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/></svg>
                    Corrigir PortuguÃªs BR
                </button>
                <button class="tool-btn" onclick="extractText()">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z"/></svg>
                    Extrair Texto
                </button>
            </div>

            <div class="tool-group">
                <h3>Ferramentas</h3>
                <button class="tool-btn" onclick="setTool(null)">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.672 1.911a1 1 0 10-1.932.518l.259.966a1 1 0 001.932-.518l-.26-.966zM2.429 4.74a1 1 0 10-.517 1.932l.966.259a1 1 0 00.517-1.932l-.966-.26zm8.814-.569a1 1 0 00-1.415-1.414l-.707.707a1 1 0 101.415 1.415l.707-.708zm-7.071 7.072l.707-.707A1 1 0 003.465 9.12l-.708.707a1 1 0 001.415 1.415zm3.2-5.171a1 1 0 00-1.3 1.3l4 10a1 1 0 001.823.075l1.38-2.759 3.018 3.02a1 1 0 001.414-1.415l-3.019-3.02 2.76-1.379a1 1 0 00-.076-1.822l-10-4z"/></svg>
                    Selecionar/Mover
                </button>
                <button class="tool-btn" onclick="setTool('text')">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/></svg>
                    Texto
                </button>
                <button class="tool-btn" onclick="setTool('draw')">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/></svg>
                    Desenhar
                </button>
                <button class="tool-btn" onclick="setTool('highlight')">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z"/></svg>
                    Destacar
                </button>
                <button class="tool-btn" onclick="setTool('erase')">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/></svg>
                    Apagar
                </button>
                <button class="tool-btn" style="background: rgba(239, 68, 68, 0.1); border-color: var(--danger);" onclick="deleteSelected()">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"/></svg>
                    Deletar Selecionado
                </button>
            </div>

            <div class="tool-group">
                <h3>Formas</h3>
                <button class="tool-btn" onclick="setTool('rectangle')">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path d="M2 6a2 2 0 012-2h12a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"/></svg>
                    RetÃ¢ngulo
                </button>
                <button class="tool-btn" onclick="setTool('circle')">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12z"/></svg>
                    CÃ­rculo
                </button>
                <button class="tool-btn" onclick="setTool('arrow')">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10.293 15.707a1 1 0 010-1.414L14.586 10l-4.293-4.293a1 1 0 111.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z"/><path fill-rule="evenodd" d="M4.293 15.707a1 1 0 010-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z"/></svg>
                    Seta
                </button>
            </div>
        </aside>

        <main class="main-content">
            <div class="toolbar" id="toolbar">
                <div class="toolbar-group">
                    <label>Cor:</label>
                    <input type="color" id="colorPicker" value="#3b82f6">
                </div>
                <div class="toolbar-group">
                    <label>Espessura:</label>
                    <input type="number" id="lineWidth" value="2" min="1" max="20">
                </div>
                <div class="toolbar-group">
                    <label>Opacidade:</label>
                    <input type="range" id="opacity" value="100" min="0" max="100">
                </div>
                <div class="toolbar-group">
                    <button class="toolbar-btn" onclick="undo()" id="undoBtn">
                        <svg fill="currentColor" viewBox="0 0 20 20" width="16"><path fill-rule="evenodd" d="M7.707 3.293a1 1 0 010 1.414L5.414 7H11a7 7 0 017 7v2a1 1 0 11-2 0v-2a5 5 0 00-5-5H5.414l2.293 2.293a1 1 0 11-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"/></svg>
                        Desfazer
                    </button>
                    <button class="toolbar-btn" onclick="redo()" id="redoBtn">
                        <svg fill="currentColor" viewBox="0 0 20 20" width="16"><path fill-rule="evenodd" d="M12.293 3.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 9H9a5 5 0 00-5 5v2a1 1 0 11-2 0v-2a7 7 0 017-7h5.586l-2.293-2.293a1 1 0 010-1.414z"/></svg>
                        Refazer
                    </button>
                    <span id="historyInfo" style="font-size: 0.75rem; color: var(--text-secondary); white-space: nowrap;"></span>
                </div>
                <div class="toolbar-group">
                    <button class="toolbar-btn" onclick="clearCanvas()">
                        <svg fill="currentColor" viewBox="0 0 20 20" width="16"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"/></svg>
                        Limpar
                    </button>
                </div>
                <div class="info-box" style="margin: 0; padding: 0.5rem 1rem; font-size: 0.8rem;">
                    <strong>Dicas:</strong> Clique duplo para editar texto | Delete/Backspace para apagar | Ctrl+Z desfazer | Ctrl+Y refazer
                </div>
            </div>

            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">ðŸ“„</div>
                <h2 style="margin-bottom: 0.5rem;">Arraste seu PDF aqui</h2>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">ou clique para selecionar</p>
                <button class="btn-primary" onclick="document.getElementById('fileInput').click()">
                    Escolher Arquivo
                </button>
                <input type="file" id="fileInput" accept=".pdf" style="display: none;">
            </div>

            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Carregando PDF...</p>
            </div>

            <div class="canvas-container" id="canvasContainer">
                <canvas id="pdfCanvas"></canvas>
                <canvas id="drawCanvas"></canvas>
            </div>

            <div class="pages-nav" id="pagesNav">
                <button class="page-btn" onclick="previousPage()">Anterior</button>
                <span id="pageInfo">PÃ¡gina 1 de 1</span>
                <button class="page-btn" onclick="nextPage()">PrÃ³xima</button>
            </div>
        </main>
    </div>

    <div class="modal" id="textModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Adicionar Texto</h2>
                <button class="modal-close" onclick="closeTextModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label>Texto:</label>
                <input type="text" id="textInput" placeholder="Digite o texto...">
            </div>
            <div class="form-group">
                <label>Tamanho:</label>
                <input type="number" id="fontSize" value="16" min="8" max="72">
            </div>
            <div class="form-group">
                <label>Fonte:</label>
                <select id="fontFamily">
                    <option value="Arial">Arial</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Courier New">Courier New</option>
                    <option value="Georgia">Georgia</option>
                </select>
            </div>
            <button class="btn-primary" onclick="addText()">Adicionar</button>
        </div>
    </div>

    <div class="modal" id="correctionModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>CorreÃ§Ã£o de PortuguÃªs BR</h2>
                <button class="modal-close" onclick="closeCorrectionModal()">Ã—</button>
            </div>
            <div id="correctionContent">
                <div class="loading active">
                    <div class="spinner"></div>
                    <p>Analisando e corrigindo o texto com IA...</p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="extractModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>Texto ExtraÃ­do</h2>
                <button class="modal-close" onclick="closeExtractModal()">Ã—</button>
            </div>
            <div class="form-group">
                <textarea id="extractedText" style="width: 100%; min-height: 300px; padding: 1rem; background: rgba(59, 130, 246, 0.1); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-family: monospace; resize: vertical;"></textarea>
            </div>
            <div style="display: flex; gap: 1rem;">
                <button class="btn-primary" onclick="copyExtractedText()">Copiar Texto</button>
                <button class="btn-secondary" onclick="closeExtractModal()">Fechar</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let pdfDoc = null;
        let pageNum = 1;
        let pageCount = 0;
        let currentTool = null;
        let isDrawing = false;
        let drawCanvas, drawCtx;
        let pdfCanvas, pdfCtx;
        let history = [];
        let historyStep = -1;
        let startX, startY;
        let textPosition = null;
        let objects = [];
        let selectedObject = null;
        let isDragging = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.classList.add('active');
            setTimeout(() => errorEl.classList.remove('active'), 5000);
        }

        function showSuccess(message) {
            const successEl = document.getElementById('successMessage');
            successEl.textContent = message;
            successEl.classList.add('active');
            setTimeout(() => successEl.classList.remove('active'), 3000);
        }

        function hideMessages() {
            document.getElementById('errorMessage').classList.remove('active');
            document.getElementById('successMessage').classList.remove('active');
        }

        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const loading = document.getElementById('loading');
        const canvasContainer = document.getElementById('canvasContainer');
        const toolbar = document.getElementById('toolbar');
        const pagesNav = document.getElementById('pagesNav');

        uploadZone.addEventListener('click', () => fileInput.click());
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('drag-over');
        });
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('drag-over');
        });
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/pdf') {
                loadPDF(file);
            }
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) loadPDF(file);
        });

        function loadPDF(file) {
            if (!file) {
                showError('Nenhum arquivo selecionado.');
                return;
            }

            if (file.type !== 'application/pdf') {
                showError('Por favor, selecione um arquivo PDF vÃ¡lido.');
                return;
            }

            hideMessages();
            loading.classList.add('active');
            uploadZone.style.display = 'none';

            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const typedarray = new Uint8Array(e.target.result);
                    
                    pdfjsLib.getDocument({ data: typedarray }).promise
                        .then(pdf => {
                            pdfDoc = pdf;
                            pageCount = pdf.numPages;
                            console.log('PDF carregado com sucesso:', pageCount, 'pÃ¡ginas');
                            return renderPage(pageNum);
                        })
                        .then(() => {
                            setupCanvas();
                            loading.classList.remove('active');
                            canvasContainer.classList.add('active');
                            toolbar.classList.add('active');
                            pagesNav.classList.add('active');
                            updatePageInfo();
                            showSuccess('PDF carregado com sucesso!');
                        })
                        .catch(error => {
                            console.error('Erro ao carregar PDF:', error);
                            loading.classList.remove('active');
                            uploadZone.style.display = 'block';
                            showError('Erro ao processar o PDF. Verifique se o arquivo nÃ£o estÃ¡ corrompido.');
                        });
                } catch (error) {
                    console.error('Erro ao processar arquivo:', error);
                    loading.classList.remove('active');
                    uploadZone.style.display = 'block';
                    showError('Erro ao processar o arquivo. Por favor, tente novamente.');
                }
            };
            
            reader.onerror = function(error) {
                console.error('Erro ao ler arquivo:', error);
                loading.classList.remove('active');
                uploadZone.style.display = 'block';
                showError('Erro ao ler o arquivo. Por favor, tente novamente.');
            };
            
            reader.readAsArrayBuffer(file);
        }

        function renderPage(num) {
            return pdfDoc.getPage(num).then(page => {
                const viewport = page.getViewport({ scale: 1.5 });
                pdfCanvas = document.getElementById('pdfCanvas');
                pdfCtx = pdfCanvas.getContext('2d');
                pdfCanvas.width = viewport.width;
                pdfCanvas.height = viewport.height;

                const renderContext = {
                    canvasContext: pdfCtx,
                    viewport: viewport
                };
                
                return page.render(renderContext).promise;
            });
        }

        function setupCanvas() {
            drawCanvas = document.getElementById('drawCanvas');
            drawCtx = drawCanvas.getContext('2d');
            
            if (!pdfCanvas || !pdfCanvas.width) {
                console.error('Canvas do PDF nÃ£o estÃ¡ pronto');
                return;
            }
            
            drawCanvas.width = pdfCanvas.width;
            drawCanvas.height = pdfCanvas.height;
            drawCanvas.style.position = 'absolute';
            drawCanvas.style.top = '0';
            drawCanvas.style.left = '0';

            drawCanvas.removeEventListener('mousedown', handleMouseDown);
            drawCanvas.removeEventListener('mousemove', handleMouseMove);
            drawCanvas.removeEventListener('mouseup', handleMouseUp);
            drawCanvas.removeEventListener('dblclick', handleDoubleClick);
            drawCanvas.removeEventListener('touchstart', handleTouch);
            drawCanvas.removeEventListener('touchmove', handleTouchMove);
            drawCanvas.removeEventListener('touchend', handleMouseUp);

            drawCanvas.addEventListener('mousedown', handleMouseDown);
            drawCanvas.addEventListener('mousemove', handleMouseMove);
            drawCanvas.addEventListener('mouseup', handleMouseUp);
            drawCanvas.addEventListener('dblclick', handleDoubleClick);

            drawCanvas.addEventListener('touchstart', handleTouch);
            drawCanvas.addEventListener('touchmove', handleTouchMove);
            drawCanvas.addEventListener('touchend', handleMouseUp);

            objects = [];
            selectedObject = null;
            saveState();
        }

        function handleMouseDown(e) {
            const rect = drawCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            selectedObject = getObjectAt(x, y);

            if (selectedObject && currentTool === null) {
                isDragging = true;
                dragOffsetX = x - selectedObject.x;
                dragOffsetY = y - selectedObject.y;
                redrawCanvas();
                return;
            }

            if (currentTool === 'text') {
                textPosition = { x, y };
                document.getElementById('textModal').classList.add('active');
                return;
            }

            if (currentTool) {
                isDrawing = true;
                startX = x;
                startY = y;

                if (currentTool === 'draw' || currentTool === 'highlight' || currentTool === 'erase') {
                    const color = document.getElementById('colorPicker').value;
                    const lineWidth = document.getElementById('lineWidth').value;
                    const opacity = document.getElementById('opacity').value / 100;
                    
                    const drawObj = {
                        type: currentTool,
                        points: [{ x, y }],
                        color: color,
                        lineWidth: parseInt(lineWidth),
                        opacity: opacity
                    };
                    objects.push(drawObj);
                }
            }
        }

        function handleMouseMove(e) {
            const rect = drawCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (!currentTool) {
                const hoveredObj = getObjectAt(x, y);
                drawCanvas.style.cursor = hoveredObj ? 'move' : 'default';
            }

            if (isDragging && selectedObject) {
                selectedObject.x = x - dragOffsetX;
                selectedObject.y = y - dragOffsetY;
                redrawCanvas();
                return;
            }

            if (!isDrawing || !currentTool) return;

            if (currentTool === 'draw' || currentTool === 'highlight' || currentTool === 'erase') {
                const lastObj = objects[objects.length - 1];
                if (lastObj && (lastObj.type === currentTool)) {
                    lastObj.points.push({ x, y });
                    redrawCanvas();
                }
            } else if (['rectangle', 'circle', 'arrow'].includes(currentTool)) {
                redrawCanvas();
                drawShapePreview(startX, startY, x, y);
            }
        }

        function handleMouseUp(e) {
            if (isDragging) {
                isDragging = false;
                saveState();
            } else if (isDrawing) {
                if (['rectangle', 'circle', 'arrow'].includes(currentTool)) {
                    const rect = drawCanvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    const color = document.getElementById('colorPicker').value;
                    const lineWidth = document.getElementById('lineWidth').value;
                    const opacity = document.getElementById('opacity').value / 100;
                    
                    const shapeObj = {
                        type: currentTool,
                        x1: startX,
                        y1: startY,
                        x2: x,
                        y2: y,
                        color: color,
                        lineWidth: parseInt(lineWidth),
                        opacity: opacity
                    };
                    objects.push(shapeObj);
                }
                
                isDrawing = false;
                redrawCanvas();
                saveState();
            }
        }

        function handleDoubleClick(e) {
            const rect = drawCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const obj = getObjectAt(x, y);
            if (obj && obj.type === 'text') {
                editTextObject(obj);
            }
        }

        function handleTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            drawCanvas.dispatchEvent(mouseEvent);
        }

        function getObjectAt(x, y) {
            for (let i = objects.length - 1; i >= 0; i--) {
                const obj = objects[i];
                if (obj.type === 'text') {
                    const metrics = drawCtx.measureText(obj.text);
                    const height = obj.fontSize;
                    if (x >= obj.x && x <= obj.x + metrics.width &&
                        y >= obj.y - height && y <= obj.y) {
                        return obj;
                    }
                }
            }
            return null;
        }

        function redrawCanvas() {
            drawCtx.clearRect(0, 0, drawCanvas.width, drawCanvas.height);
            
            objects.forEach(obj => {
                if (obj.type === 'text') {
                    drawCtx.font = `${obj.fontSize}px ${obj.fontFamily}`;
                    drawCtx.fillStyle = obj.color;
                    drawCtx.globalAlpha = 1;
                    drawCtx.fillText(obj.text, obj.x, obj.y);

                    if (obj === selectedObject) {
                        const metrics = drawCtx.measureText(obj.text);
                        drawCtx.strokeStyle = '#3b82f6';
                        drawCtx.lineWidth = 2;
                        drawCtx.setLineDash([5, 5]);
                        drawCtx.strokeRect(obj.x - 5, obj.y - obj.fontSize - 5, metrics.width + 10, obj.fontSize + 10);
                        drawCtx.setLineDash([]);
                    }
                } else if (obj.type === 'draw' || obj.type === 'highlight') {
                    if (obj.points && obj.points.length > 0) {
                        drawCtx.strokeStyle = obj.color;
                        drawCtx.lineWidth = obj.lineWidth;
                        drawCtx.globalAlpha = obj.type === 'highlight' ? 0.3 : obj.opacity;
                        drawCtx.lineCap = 'round';
                        drawCtx.lineJoin = 'round';
                        
                        drawCtx.beginPath();
                        drawCtx.moveTo(obj.points[0].x, obj.points[0].y);
                        for (let i = 1; i < obj.points.length; i++) {
                            drawCtx.lineTo(obj.points[i].x, obj.points[i].y);
                        }
                        drawCtx.stroke();
                    }
                } else if (obj.type === 'erase') {
                    if (obj.points && obj.points.length > 0) {
                        drawCtx.globalCompositeOperation = 'destination-out';
                        for (let point of obj.points) {
                            drawCtx.beginPath();
                            drawCtx.arc(point.x, point.y, obj.lineWidth / 2, 0, Math.PI * 2);
                            drawCtx.fill();
                        }
                        drawCtx.globalCompositeOperation = 'source-over';
                    }
                } else if (obj.type === 'rectangle') {
                    drawCtx.strokeStyle = obj.color;
                    drawCtx.lineWidth = obj.lineWidth;
                    drawCtx.globalAlpha = obj.opacity;
                    drawCtx.strokeRect(obj.x1, obj.y1, obj.x2 - obj.x1, obj.y2 - obj.y1);
                } else if (obj.type === 'circle') {
                    const radius = Math.sqrt(Math.pow(obj.x2 - obj.x1, 2) + Math.pow(obj.y2 - obj.y1, 2));
                    drawCtx.strokeStyle = obj.color;
                    drawCtx.lineWidth = obj.lineWidth;
                    drawCtx.globalAlpha = obj.opacity;
                    drawCtx.beginPath();
                    drawCtx.arc(obj.x1, obj.y1, radius, 0, 2 * Math.PI);
                    drawCtx.stroke();
                } else if (obj.type === 'arrow') {
                    drawCtx.strokeStyle = obj.color;
                    drawCtx.lineWidth = obj.lineWidth;
                    drawCtx.globalAlpha = obj.opacity;
                    
                    const headlen = 20;
                    const angle = Math.atan2(obj.y2 - obj.y1, obj.x2 - obj.x1);
                    
                    drawCtx.beginPath();
                    drawCtx.moveTo(obj.x1, obj.y1);
                    drawCtx.lineTo(obj.x2, obj.y2);
                    drawCtx.lineTo(obj.x2 - headlen * Math.cos(angle - Math.PI / 6), obj.y2 - headlen * Math.sin(angle - Math.PI / 6));
                    drawCtx.moveTo(obj.x2, obj.y2);
                    drawCtx.lineTo(obj.x2 - headlen * Math.cos(angle + Math.PI / 6), obj.y2 - headlen * Math.sin(angle + Math.PI / 6));
                    drawCtx.stroke();
                }
            });
            
            drawCtx.globalAlpha = 1;
        }

        function drawShapePreview(x1, y1, x2, y2) {
            const color = document.getElementById('colorPicker').value;
            const lineWidth = document.getElementById('lineWidth').value;
            const opacity = document.getElementById('opacity').value / 100;

            drawCtx.strokeStyle = color;
            drawCtx.lineWidth = lineWidth;
            drawCtx.globalAlpha = opacity;

            drawCtx.beginPath();

            if (currentTool === 'rectangle') {
                drawCtx.strokeRect(x1, y1, x2 - x1, y2 - y1);
            } else if (currentTool === 'circle') {
                const radius = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                drawCtx.arc(x1, y1, radius, 0, 2 * Math.PI);
            } else if (currentTool === 'arrow') {
                const headlen = 20;
                const angle = Math.atan2(y2 - y1, x2 - x1);
                
                drawCtx.moveTo(x1, y1);
                drawCtx.lineTo(x2, y2);
                drawCtx.lineTo(x2 - headlen * Math.cos(angle - Math.PI / 6), y2 - headlen * Math.sin(angle - Math.PI / 6));
                drawCtx.moveTo(x2, y2);
                drawCtx.lineTo(x2 - headlen * Math.cos(angle + Math.PI / 6), y2 - headlen * Math.sin(angle + Math.PI / 6));
            }

            drawCtx.stroke();
            drawCtx.globalAlpha = 1;
        }

        function setTool(tool) {
            currentTool = tool;
            selectedObject = null;
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.tool-btn').classList.add('active');
            
            if (tool === 'text') {
                drawCanvas.style.cursor = 'text';
            } else if (tool === 'erase') {
                drawCanvas.style.cursor = 'not-allowed';
            } else if (tool === null) {
                drawCanvas.style.cursor = 'default';
            } else {
                drawCanvas.style.cursor = 'crosshair';
            }
            redrawCanvas();
        }

        function startDrawing(e) {
            if (!currentTool) return;
            
            isDrawing = true;
            const rect = drawCanvas.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;

            if (currentTool === 'text') {
                textPosition = { x: startX, y: startY };
                document.getElementById('textModal').classList.add('active');
                isDrawing = false;
                return;
            }

            drawCtx.beginPath();
            drawCtx.moveTo(startX, startY);
        }

        function draw(e) {
            if (!isDrawing || !currentTool) return;

            const rect = drawCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const color = document.getElementById('colorPicker').value;
            const lineWidth = document.getElementById('lineWidth').value;
            const opacity = document.getElementById('opacity').value / 100;

            drawCtx.strokeStyle = color;
            drawCtx.lineWidth = lineWidth;
            drawCtx.globalAlpha = opacity;
            drawCtx.lineCap = 'round';

            if (currentTool === 'draw') {
                drawCtx.lineTo(x, y);
                drawCtx.stroke();
            } else if (currentTool === 'erase') {
                drawCtx.clearRect(x - lineWidth/2, y - lineWidth/2, lineWidth, lineWidth);
            } else if (currentTool === 'highlight') {
                drawCtx.globalAlpha = 0.3;
                drawCtx.lineTo(x, y);
                drawCtx.stroke();
            } else if (['rectangle', 'circle', 'arrow'].includes(currentTool)) {
                restoreState();
                drawShape(startX, startY, x, y);
            }
        }

        function drawShape(x1, y1, x2, y2) {
            const color = document.getElementById('colorPicker').value;
            const lineWidth = document.getElementById('lineWidth').value;
            const opacity = document.getElementById('opacity').value / 100;

            drawCtx.strokeStyle = color;
            drawCtx.lineWidth = lineWidth;
            drawCtx.globalAlpha = opacity;

            drawCtx.beginPath();

            if (currentTool === 'rectangle') {
                drawCtx.rect(x1, y1, x2 - x1, y2 - y1);
            } else if (currentTool === 'circle') {
                const radius = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                drawCtx.arc(x1, y1, radius, 0, 2 * Math.PI);
            } else if (currentTool === 'arrow') {
                const headlen = 20;
                const angle = Math.atan2(y2 - y1, x2 - x1);
                
                drawCtx.moveTo(x1, y1);
                drawCtx.lineTo(x2, y2);
                drawCtx.lineTo(x2 - headlen * Math.cos(angle - Math.PI / 6), y2 - headlen * Math.sin(angle - Math.PI / 6));
                drawCtx.moveTo(x2, y2);
                drawCtx.lineTo(x2 - headlen * Math.cos(angle + Math.PI / 6), y2 - headlen * Math.sin(angle + Math.PI / 6));
            }

            drawCtx.stroke();
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            drawCanvas.dispatchEvent(mouseEvent);
        }

        function addText() {
            const text = document.getElementById('textInput').value;
            const fontSize = parseInt(document.getElementById('fontSize').value);
            const fontFamily = document.getElementById('fontFamily').value;
            const color = document.getElementById('colorPicker').value;

            if (!text || !textPosition) return;

            const textObj = {
                type: 'text',
                text: text,
                x: textPosition.x,
                y: textPosition.y,
                fontSize: fontSize,
                fontFamily: fontFamily,
                color: color
            };

            objects.push(textObj);
            redrawCanvas();
            saveState();
            closeTextModal();
        }

        function editTextObject(obj) {
            document.getElementById('textInput').value = obj.text;
            document.getElementById('fontSize').value = obj.fontSize;
            document.getElementById('fontFamily').value = obj.fontFamily;
            document.getElementById('colorPicker').value = obj.color;
            
            const modal = document.getElementById('textModal');
            modal.classList.add('active');
            
            const saveBtn = modal.querySelector('.btn-primary');
            saveBtn.textContent = 'Atualizar';
            saveBtn.onclick = function() {
                obj.text = document.getElementById('textInput').value;
                obj.fontSize = parseInt(document.getElementById('fontSize').value);
                obj.fontFamily = document.getElementById('fontFamily').value;
                obj.color = document.getElementById('colorPicker').value;
                redrawCanvas();
                saveState();
                closeTextModal();
                saveBtn.textContent = 'Adicionar';
                saveBtn.onclick = addText;
            };
        }

        function closeTextModal() {
            document.getElementById('textModal').classList.remove('active');
            document.getElementById('textInput').value = '';
            textPosition = null;
            const saveBtn = document.getElementById('textModal').querySelector('.btn-primary');
            saveBtn.textContent = 'Adicionar';
            saveBtn.onclick = addText;
        }

        function saveState() {
            historyStep++;
            if (historyStep < history.length) {
                history.length = historyStep;
            }
            history.push(JSON.parse(JSON.stringify(objects)));
            updateHistoryInfo();
            console.log('Estado salvo. Total de estados:', history.length, 'Passo atual:', historyStep);
        }

        function restoreState() {
            if (historyStep >= 0 && historyStep < history.length) {
                objects = JSON.parse(JSON.stringify(history[historyStep]));
                selectedObject = null;
                redrawCanvas();
                updateHistoryInfo();
                console.log('Estado restaurado. Passo:', historyStep, 'Total de objetos:', objects.length);
            }
        }

        function updateHistoryInfo() {
            const historyInfoEl = document.getElementById('historyInfo');
            if (historyInfoEl) {
                const undoCount = historyStep;
                const redoCount = history.length - historyStep - 1;
                historyInfoEl.textContent = `${objects.length} objetos | ${undoCount} desfazer | ${redoCount} refazer`;
            }
            
            const undoBtn = document.getElementById('undoBtn');
            const redoBtn = document.getElementById('redoBtn');
            if (undoBtn) {
                undoBtn.style.opacity = historyStep > 0 ? '1' : '0.5';
                undoBtn.style.cursor = historyStep > 0 ? 'pointer' : 'not-allowed';
            }
            if (redoBtn) {
                redoBtn.style.opacity = historyStep < history.length - 1 ? '1' : '0.5';
                redoBtn.style.cursor = historyStep < history.length - 1 ? 'pointer' : 'not-allowed';
            }
        }

        function undo() {
            if (historyStep > 0) {
                historyStep--;
                restoreState();
                showSuccess('AÃ§Ã£o desfeita');
            } else {
                showError('NÃ£o hÃ¡ mais aÃ§Ãµes para desfazer');
            }
        }

        function redo() {
            if (historyStep < history.length - 1) {
                historyStep++;
                restoreState();
                showSuccess('AÃ§Ã£o refeita');
            } else {
                showError('NÃ£o hÃ¡ mais aÃ§Ãµes para refazer');
            }
        }

        function clearCanvas() {
            if (confirm('Tem certeza que deseja limpar todas as anotaÃ§Ãµes?')) {
                drawCtx.clearRect(0, 0, drawCanvas.width, drawCanvas.height);
                objects = [];
                selectedObject = null;
                redrawCanvas();
                saveState();
                showSuccess('Canvas limpo');
            }
        }

        function previousPage() {
            if (pageNum > 1) {
                pageNum--;
                loading.classList.add('active');
                canvasContainer.classList.remove('active');
                
                renderPage(pageNum).then(() => {
                    drawCtx.clearRect(0, 0, drawCanvas.width, drawCanvas.height);
                    drawCanvas.width = pdfCanvas.width;
                    drawCanvas.height = pdfCanvas.height;
                    objects = [];
                    selectedObject = null;
                    history = [];
                    historyStep = -1;
                    saveState();
                    updatePageInfo();
                    loading.classList.remove('active');
                    canvasContainer.classList.add('active');
                }).catch(error => {
                    console.error('Erro ao carregar pÃ¡gina:', error);
                    loading.classList.remove('active');
                    canvasContainer.classList.add('active');
                });
            }
        }

        function nextPage() {
            if (pageNum < pageCount) {
                pageNum++;
                loading.classList.add('active');
                canvasContainer.classList.remove('active');
                
                renderPage(pageNum).then(() => {
                    drawCtx.clearRect(0, 0, drawCanvas.width, drawCanvas.height);
                    drawCanvas.width = pdfCanvas.width;
                    drawCanvas.height = pdfCanvas.height;
                    objects = [];
                    selectedObject = null;
                    history = [];
                    historyStep = -1;
                    saveState();
                    updatePageInfo();
                    loading.classList.remove('active');
                    canvasContainer.classList.add('active');
                }).catch(error => {
                    console.error('Erro ao carregar pÃ¡gina:', error);
                    loading.classList.remove('active');
                    canvasContainer.classList.add('active');
                });
            }
        }

        function updatePageInfo() {
            document.getElementById('pageInfo').textContent = `PÃ¡gina ${pageNum} de ${pageCount}`;
        }

        function savePDF() {
            if (!pdfDoc || !pdfCanvas || !drawCanvas) {
                showError('Por favor, carregue um PDF primeiro.');
                return;
            }

            try {
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = pdfCanvas.width;
                tempCanvas.height = pdfCanvas.height;
                const tempCtx = tempCanvas.getContext('2d');

                tempCtx.drawImage(pdfCanvas, 0, 0);
                tempCtx.drawImage(drawCanvas, 0, 0);

                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: pdfCanvas.width > pdfCanvas.height ? 'landscape' : 'portrait',
                    unit: 'px',
                    format: [pdfCanvas.width, pdfCanvas.height]
                });

                const imgData = tempCanvas.toDataURL('image/jpeg', 1.0);
                pdf.addImage(imgData, 'JPEG', 0, 0, pdfCanvas.width, pdfCanvas.height);

                pdf.save('documento-editado-wolfguard.pdf');
                showSuccess('PDF salvo com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar PDF:', error);
                showError('Erro ao salvar o PDF. Por favor, tente novamente.');
            }
        }

        function convertToWord() {
            alert('Funcionalidade de conversÃ£o para Word serÃ¡ implementada. Por enquanto, vocÃª pode salvar como PDF editado.');
        }

        async function extractText() {
            if (!pdfDoc) {
                showError('Por favor, carregue um PDF primeiro.');
                return;
            }

            try {
                document.getElementById('extractModal').classList.add('active');
                let fullText = '';

                for (let i = 1; i <= pageCount; i++) {
                    const page = await pdfDoc.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += `\n--- PÃ¡gina ${i} ---\n${pageText}\n`;
                }

                document.getElementById('extractedText').value = fullText;
                showSuccess('Texto extraÃ­do com sucesso!');
            } catch (error) {
                console.error('Erro ao extrair texto:', error);
                showError('Erro ao extrair texto do PDF.');
                closeExtractModal();
            }
        }

        function closeExtractModal() {
            document.getElementById('extractModal').classList.remove('active');
        }

        function copyExtractedText() {
            const text = document.getElementById('extractedText').value;
            navigator.clipboard.writeText(text).then(() => {
                showSuccess('Texto copiado para a Ã¡rea de transferÃªncia!');
            }).catch(error => {
                console.error('Erro ao copiar:', error);
                showError('Erro ao copiar texto.');
            });
        }

        async function correctPortuguese() {
            if (!pdfDoc) {
                showError('Por favor, carregue um PDF primeiro.');
                return;
            }

            document.getElementById('correctionModal').classList.add('active');
            
            try {
                let fullText = '';
                for (let i = 1; i <= Math.min(pageCount, 5); i++) {
                    const page = await pdfDoc.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + '\n\n';
                }

                if (pageCount > 5) {
                    fullText = fullText.substring(0, 3000);
                }

                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [{
                            role: 'user',
                            content: `Analise o texto a seguir e corrija TODOS os erros de portuguÃªs brasileiro (ortografia, gramÃ¡tica, pontuaÃ§Ã£o, concordÃ¢ncia, acentuaÃ§Ã£o, etc). Liste os erros encontrados e suas correÃ§Ãµes de forma clara e organizada.

Texto para correÃ§Ã£o:
${fullText}

Responda apenas com as correÃ§Ãµes em formato de lista clara.`
                        }]
                    })
                });

                const data = await response.json();
                const correctedText = data.content.map(item => item.type === 'text' ? item.text : '').join('\n');

                document.getElementById('correctionContent').innerHTML = `
                    <div style="padding: 1rem; background: rgba(59, 130, 246, 0.05); border-radius: 8px; margin-bottom: 1rem;">
                        <h3 style="margin-bottom: 1rem; color: var(--success);">CorreÃ§Ãµes Identificadas:</h3>
                        <div style="white-space: pre-wrap; line-height: 1.8; color: var(--text);">${correctedText}</div>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button class="btn-primary" onclick="copyCorrections()">Copiar CorreÃ§Ãµes</button>
                        <button class="btn-secondary" onclick="closeCorrectionModal()">Fechar</button>
                    </div>
                `;
                showSuccess('CorreÃ§Ã£o concluÃ­da!');
            } catch (error) {
                console.error('Erro na correÃ§Ã£o:', error);
                document.getElementById('correctionContent').innerHTML = `
                    <div style="padding: 2rem; text-align: center; color: var(--danger);">
                        <p style="margin-bottom: 1rem;">Erro ao processar correÃ§Ã£o. Por favor, tente novamente.</p>
                        <button class="btn-secondary" onclick="closeCorrectionModal()">Fechar</button>
                    </div>
                `;
                showError('Erro ao processar correÃ§Ã£o.');
            }
        }

        function copyCorrections() {
            try {
                const text = document.querySelector('#correctionContent div[style*="white-space"]').textContent;
                navigator.clipboard.writeText(text).then(() => {
                    showSuccess('CorreÃ§Ãµes copiadas para a Ã¡rea de transferÃªncia!');
                });
            } catch (error) {
                console.error('Erro ao copiar:', error);
                showError('Erro ao copiar correÃ§Ãµes.');
            }
        }

        function closeCorrectionModal() {
            document.getElementById('correctionModal').classList.remove('active');
        }

        function deleteSelected() {
            if (selectedObject) {
                const index = objects.indexOf(selectedObject);
                if (index > -1) {
                    objects.splice(index, 1);
                    selectedObject = null;
                    redrawCanvas();
                    saveState();
                    showSuccess('Objeto deletado');
                }
            } else {
                showError('Nenhum objeto selecionado');
            }
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Delete' || e.key === 'Backspace') {
                if (selectedObject && !document.querySelector('.modal.active')) {
                    e.preventDefault();
                    deleteSelected();
                }
            }
            
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'z') {
                    e.preventDefault();
                    undo();
                } else if (e.key === 'y') {
                    e.preventDefault();
                    redo();
                }
            }
        });
    </script>
</body>
</html>